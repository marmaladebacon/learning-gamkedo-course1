<html>
    <h2>first game run through</h2>

<canvas id="gameCanvas" width="800" height="600"></canvas>

<script>
// handle/reference to the information on our display area
var canvas;
// Canvas's underlying information where we draw shapes to
var canvasContext;
var ballSpeedX = 5;
var ballSpeedY = 4;
var ballModel = makeCircleModel(50, 250, 10, 'red' );
var playerLeftPad = makeRectModel(0, 200, 10, 100, 'white');
var playerRightPad = makeRectModel(0, 200, 10, 100, 'white');
var boardModel; 
//var mousePos = {x:0, y:0};
//onload runs only after everything on the page has finished loading
window.onload = function(){
    console.log('game start');
    //draw order matters, the later draw calls will cover the earlier draw calls
    canvas = document.getElementById('gameCanvas');
    canvasContext = canvas.getContext('2d');
    playerRightPad = makeRectModel(canvas.width-10, 200, 10, 100, 'cyan');
    boardModel = makeRectModel(0,0,canvas.width, canvas.height, 'black');
    var framesPerSecond = 60;
    setInterval(function(){moveEverything(); drawEverything()}, 1000/framesPerSecond);
    canvas.addEventListener('mousemove', function(evt){
        var mPos = calculateMousePos(evt);
        playerLeftPad.y = mPos.y - playerLeftPad.height/2; 
    })
    //setInterval(drawEverything, 16);
}
//Should be callled everytime the mouse moves
function calculateMousePos(evt){
    var rect = canvas.getBoundingClientRect();
    var root = document.documentElement;
    //accounting for rect position, and if scrollbars on the window are in play, how far have we scrolled
    var mouseX = evt.clientX - rect.left - root.scrollLeft; 
    var mouseY = evt.clientY - rect.top - root.scrollTop;
    return {
        x: mouseX,
        y: mouseY
    }
}

function resetBall(){
    ballModel.x = canvas.width/2;
    ballModel.y = canvas.height/2;
}

function moveEverything(){
    ballModel.x += ballSpeedX;
    ballModel.y += ballSpeedY;
    if( ballModel.x <=ballModel.radius ){
        if(ballModel.y > playerLeftPad.y && ballModel.y<(playerLeftPad.y + playerLeftPad.height )){
            ballSpeedX *= -1;
        }else{
            resetBall();    
        }                
    }

    if(ballModel.x >= (canvas.width-ballModel.radius)){
        ballSpeedX *= -1;
        if(ballModel.y > playerRightPad.y && ballModel.y<(playerRightPad.y + playerRightPad.height )){
            ballSpeedX *= -1;
        }else{
            //resetBall();    
        }                
    } 
    if(ballModel.y >= (canvas.height - ballModel.radius) || ballModel.y <=ballModel.radius){
        ballSpeedY *= -1;
    }
}

function drawEverything(){    
    drawRectModel(boardModel);
    drawRectModel(playerLeftPad);
    drawRectModel(playerRightPad);
    drawCircleModel(ballModel);
}

function drawCircleModel(model){
    canvasContext.fillStyle = 'red';
    canvasContext.beginPath();
    canvasContext.arc(ballModel.x, ballModel.y, ballModel.radius, 0, Math.PI*2, true);
    canvasContext.fill();
}

function drawRectModel(model){
    canvasContext.fillStyle = model.color;
    canvasContext.fillRect(model.x, model.y, model.width, model.height);
}

function makeRectModel(x,y, width, height, color){
    return {x:x, y:y, width: width, height: height, color: color};
}

function makeCircleModel(x,y, radius, color){
    return {x:x, y:y,radius:radius, color: color};
}
</script>

</html>